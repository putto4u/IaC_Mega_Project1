

## 20대 PC & AWS 연동 하이브리드 클라우드 구축 마스터 플랜

이 프로젝트는 학원 내 물리 자원을 최대한 활용하여 **비용을 0에 가깝게 유지**하면서, 필요 시에만 AWS 자원을 동적으로 끌어다 쓰는 **하이브리드 오케스트레이션** 환경 구현을 목표로 합니다.

### 1. 인프라 자원 배치 및 PC별 작업 정의

| PC 번호 | 역할 (Role) | 세부 설치 및 작업 내용 |
| --- | --- | --- |
| **PC #01** | **Main Controller** | **Terraform 마스터**, K8s Control Plane, AWS CLI/인증 설정 |
| **PC #02** | **Network Gateway** | **NAT 서버**, **WireGuard VPN 서버** (AWS EC2와의 터널링 종착지) |
| **PC #03~04** | **Storage Layer** | **MinIO** (S3 호환), **Nextcloud** (추천 파일서버) 설치 |
| **PC #05~18** | **On-Prem Workers** | 학원 내 K8s 워커 노드 (내부 웹, DB 서버용) |
| **PC #19** | **Infra Service** | **DNS 서버**(Bind9), Private Registry, 메일 서버 |
| **PC #20** | **Monitoring** | Prometheus, Grafana (학원 & AWS 통합 모니터링) |
| **AWS (Cloud)** | **Bursting Nodes** | **Spot Instance** 기반 웹 서버 (트래픽 증가 시 자동 확장) |

### 2. 하이브리드 클라우드 구축 작업 스케줄

| 단계 | 작업명 | 세부 실행 내용 |
| --- | --- | --- |
| **D-1** | **환경 빌드** | PC 20대 VirtualBox 설치, 각 PC당 우분투 VM 2개 생성 및 SSH 통신 확인 |
| **D-2** | **IaC 인프라 선언** | PC #01에서 Terraform으로 학원 내 VM 및 AWS VPC/Subnet 일괄 정의 |
| **D-3** | **하이브리드 네트워킹** | PC #02(WireGuard)와 AWS EC2 간 VPN 터널 구축 (S2S VPN 서비스 미사용) |
| **D-4** | **K8s 클러스터 통합** | 학원 마스터에 AWS EC2를 워커 노드로 조인 (VPN 터널 통신 확인) |
| **D-5** | **서비스 배포** | DB(3대 Master-Slave), Nextcloud(파일서버), 메일 서버 배포 |
| **D-6** | **스케일 아웃 테스트** | AWS Spot Instance 기반 웹 서버 자동 확장(HPA) 및 부하 분산 테스트 |

### 3. 주요 기술 스택 및 솔루션

* **파일 서버:** **Nextcloud** (웹/모바일 연동이 강력한 오픈소스 솔루션)
* **VPN:** **WireGuard** (AWS 고정 VPN 비용을 아끼기 위해 EC2에 직접 구축)
* **DB:** **MariaDB with Galera Cluster** (Read용 복제본 1대 포함 고가용성 구성)
* **AWS 확장:** **Terraform Spot Fleet** (비용을 70% 이상 절감하는 스팟 인스턴스 활용)

### 4. AWS 과금 및 유료 전환 주의사항 (필독)

AWS 작업을 추가함에 따라 다음 사항을 반드시 체크해야 과금을 방지할 수 있습니다.

> [!CAUTION] **AWS 비용 관리 핵심 체크리스트**
> 1. **Public IPv4 주소 (유료):** 모든 퍼블릭 IP에 시간당 $0.005가 부과됩니다. 테스트 미사용 시 반드시 인스턴스를 종료하고 IP를 릴리즈하세요.
> 2. **EBS 볼륨 (유료):** 인스턴스를 삭제해도 EBS만 남을 수 있습니다. 테라폼 코드에서 `delete_on_termination = true` 설정을 확인하세요.
> 3. **NAT Gateway (주의):** AWS 전용 NAT Gateway는 시간당 비용이 비쌉니다. 학원 내 PC #02(NAT)를 거치도록 라우팅하여 비용을 0원으로 만드세요.
> 4. **Spot Instance (유료):** 온디맨드보다 저렴하지만 엄연히 유료입니다. 수업 종료 후 `terraform destroy`는 필수입니다.
> 
> 

---

### Reference

* [Nextcloud Documentation](https://docs.nextcloud.com/)
* [Terraform AWS Spot Instance Guide](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/spot_instance_request)
* [WireGuard VPN Setup](https://www.wireguard.com/install/)

---

**Next Level :** WireGuard를 이용한 학원-AWS간 VPN 자동 구축 코드

Terraform AWS Spot Fleet 설정법 | Nextcloud K8s 배포 전략 | AWS Public IP 비용 최적화 방안
