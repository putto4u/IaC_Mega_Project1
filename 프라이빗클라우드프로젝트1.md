

## 20대 PC & AWS 연동 하이브리드 보안 인프라 구축 마스터 플랜

본 인프라는 고성능 PC 20대(총 40개의 VM 자원)를 활용하여 **프라이빗 클라우드(Core)**를 구축하고, 트래픽 폭주 시 AWS로 자동 확장되는 **하이브리드 오케스트레이션** 환경을 지향합니다. 전체 시스템은 **Terraform**을 통한 선언적 인프라 관리와 **Kubernetes** 기반의 컨테이너 운영을 통해 고가용성을 확보하며, 특히 모든 트래픽을 사설 VPN 터널 내에서 제어하여 **보안성과 비용 효율성(공인 IP 비용 제로)**을 동시에 달성합니다.

단순한 서버 운영을 넘어 **Suricata(IDS/IPS)**를 통한 실시간 침입 탐지 및 차단, **Wazuh(SIEM)** 기반의 중앙 집중형 보안 관제, 그리고 **Kali Linux**를 활용한 모의 해킹 실습이 통합된 엔터프라이즈급 보안 실습 아키텍처입니다.

### 1. 인프라 자원 배치 및 기기별 역할 정의

| 기기 번호 | 역할 (Role) | 세부 설치 및 보안 솔루션 내용 |
| --- | --- | --- |
| **PC #01** | **Main Controller** | Terraform, K8s Control Plane, 보안 정책 관리 |
| **PC #02** | **Security Gateway** | **Suricata (IDS/IPS)**, NAT, WireGuard VPN (트래픽 분석 및 차단) |
| **PC #03~04** | **Storage Layer** | MinIO, Nextcloud (데이터 암호화 저장 및 공유) |
| **PC #05~15** | **Core Workers** | 내부 웹, DB 서버 컨테이너 상주 (보안 강화된 환경) |
| **PC #16** | **Pentest Server** | **Kali Linux**, Metasploit, DVWA (모의 해킹 및 취약점 진단 서버) |
| **PC #17** | **Security Analysis** | **Wazuh (SIEM/HIDS)** 또는 Snort (로그 분석 및 엔드포인트 보안) |
| **PC #18** | **Full Monitoring** | **Zabbix** 또는 **Netdata** (전체 시스템 자원 실시간 모니터링) |
| **PC #19** | **Infra Service** | DNS, Private Registry, 메일 서버(Mailcow) |
| **PC #20** | **Observability** | **Grafana, Prometheus, Loki** (로그 수집 및 시각화) |
| **AWS (Cloud)** | **Bursting Nodes** | 스팟 인스턴스 웹 서버 (보안 에이전트 포함 설치) |

### 2. 단계별 작업 스케줄

| 단계 | 작업명 | 세부 실행 내용 |
| --- | --- | --- |
| **D-1** | **기초 환경 빌드** | PC 20대 VirtualBox 설치 및 우분투 VM 생성, 내부망/호스트 전용 어댑터 설정 |
| **D-2** | **보안 관문 구축** | PC #02에 **Suricata** 설치 및 인라인 모드(IPS) 설정, VPN 터널 준비 |
| **D-3** | **관제 시스템 구성** | PC #18(Zabbix), PC #20(Grafana)을 통해 전 기기 대시보드 연결 |
| **D-4** | **하이브리드 확장** | AWS에 공인 IP 없는 스팟 인스턴스 생성 및 VPN을 통한 사설망 조인 |
| **D-5** | **해킹/방어 실습** | PC #16(Kali)에서 모의 공격 수행 -> PC #02/17에서 탐지 및 차단 검증 |
| **D-6** | **원복 및 최적화** | AWS 자원 삭제 후 내부 클러스터 상태 확인 및 보안 정책 최종 업데이트 |

### 3. 주요 오픈소스 기술 스택 및 서버 프로그램 상세

본 프로젝트에 설치될 핵심 서버 프로그램의 버전과 상세 역할입니다.

| 프로그램명 | 권장 버전 | 상세 설명 및 역할 |
| --- | --- | --- |
| **Suricata** | **7.0.x (최신)** | **IDS/IPS:** 멀티스레드 기반의 네트워크 침입 탐지 및 차단 시스템. PC #02 게이트웨이에서 인라인 모드로 동작하여 악성 트래픽 실시간 차단. |
| **Zabbix** | **6.4 LTS** | **시스템 모니터링:** 에이전트 기반 통합 관제 솔루션. 20대 PC의 CPU, RAM, 네트워크 대역폭 및 가용성 실시간 감시. |
| **Wazuh** | **4.7.x** | **SIEM/HIDS:** 보안 로그 분석 및 위협 인텔리전스 통합. 엔드포인트의 파일 무결성 및 시스템 침입 시도 분석(PC #17). |
| **Nextcloud** | **28.0.x (Hub 7)** | **파일 서버:** 기업용 클라우드 저장소. K8s 상에 배포되어 데이터 공유 및 문서 협업 인터페이스 제공(PC #03~04). |
| **MinIO** | **RELEASE.2024.x** | **S3 저장소:** 고성능 분산 오브젝트 스토리지. Nextcloud 및 K8s 서비스의 영구 저장소(PVC) 백엔드로 활용. |
| **MariaDB** | **11.x (LTS)** | **데이터베이스:** Galera Cluster를 통한 고가용성 DB. 웹 서버의 데이터를 저장하며 Read용 1대를 별도 분리하여 부하 분산. |
| **Kali Linux** | **2024.1 (Rolling)** | **모의 해킹:** 침투 테스트용 OS. Metasploit, Nmap 등 600개 이상의 보안 도구가 포함되어 내부망 취약점 점검 수행(PC #16). |
| **WireGuard** | **Linux Kernel 내장** | **VPN:** 최신 암호화 기술 기반 가상 사설망. 인프라와 AWS EC2 간의 보안 터널을 생성하여 사설 IP 통신 지원. |
| **Grafana** | **10.x** | **데이터 시각화:** Prometheus 및 Loki와 연동하여 시스템 상태 및 보안 이벤트를 대시보드로 시각화(PC #20). |
| **Mailcow** | **Latest (Docker)** | **메일 서버:** Docker 기반 통합 메일 솔루션. SMTP/IMAP 서비스 및 스팸 필터링 기능을 포함하여 내부 통신용 메일 구축. |

### 4. AWS 비용 및 자원 관리 주의사항 (최적화 버전)

공인 IP와 NAT Gateway를 배제하여 고정 비용을 차단합니다.

> [!CAUTION] **비용 제로화를 위한 체크리스트**
> 1. **Public IPv4 (제거됨):** 모든 EC2는 사설 IP만 사용하여 주소 요금을 방지합니다.
> 2. **Security Agent (주의):** 모니터링 에이전트(Zabbix Agent 등) 전송 시 발생하는 내부 트래픽은 무료이나, 리전 간 전송 시 소액의 비용이 발생할 수 있습니다.
> | 3. **EBS 볼륨 (유료):** 웹 서버는 Stateless이므로 기본 8GB 볼륨만 사용하고, 인스턴스 삭제 시 볼륨도 자동 삭제되도록 설정합니다.
> | 4. **Spot Instance (유료):** 테스트가 끝나면 반드시 `terraform destroy`를 수행하세요.
> 
> 

---

### 5. 보안 운영 및 원복 프로세스

1. **공격 탐지:** PC #16(Kali)에서 발생한 트래픽을 PC #02(Suricata)가 탐지하여 PC #17(Wazuh)로 알람을 보냅니다.
2. **스케일 아웃 보안:** AWS로 확장된 웹 서버들에도 모니터링 에이전트를 자동 배포(Ansible 활용)하여 통합 관제에 포함시킵니다.
3. **자원 원복:** `terraform destroy`로 AWS 노드를 제거하면, K8s 스케줄러가 Pod들을 자동으로 내부 보안망(PC #05~15)으로 이동시킵니다.

---

### Reference

* [Suricata - Open Source IDS/IPS/NSM](https://suricata.io/)
* [Zabbix - Enterprise-class Monitoring](https://www.zabbix.com/)
* [Wazuh - Open Source Security Platform](https://wazuh.com/)
* [Kali Linux - Penetration Testing Tools](https://www.kali.org/)

---

**Next Level :** Suricata 침입 탐지 룰(Rule) 작성법

Wazuh와 Grafana 연동 대시보드 구축 | Kali Linux를 이용한 네트워크 스캐닝 실습 | Zabbix 알람(Slack/Email) 자동화 설정
